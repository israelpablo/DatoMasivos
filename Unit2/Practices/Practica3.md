## Pratice 3 ##

the firt step is we need add the necesary librerys
```
package org.apache.spark.examples.ml
import org.apache.spark.ml.Pipeline
import org.apache.spark.ml.classification.{RandomForestClassificationModel, RandomForestClassifier}
import org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator
import org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}
import org.apache.spark.sql.SparkSession
```

we start the sesion on spark

```
val spark = SparkSession
.builder
.appName("RandomForestClassifierExample")
.getOrCreate()
```
 afther that we need add the data for analisys. 
 
```
    val data = spark.read.format("libsvm").load("c:/Spark/data/mllib/sample_libsvm_data.txt")
```

now we create the stringindexer for our example

```
val labelIndexer = new StringIndexer()
labelIndexer.setInputCol("label")
labelIndexer.setOutputCol("indexedLabel")
labelIndexer.setHandleInvalid("skip")
labelIndexer.fit(data)
```

this step is not contemplate on the spark document but we need for other next configurations 

```
val labelindexed = labelIndexer.fit(data).transform(data)
```
here we create our vectorindex

```
val featureIndexer = new VectorIndexer()
featureIndexer.setInputCol("features")
featureIndexer.setOutputCol("indexedFeatures")
featureIndexer.setMaxCategories(4)
featureIndexer.setHandleInvalid("skip")
featureIndexer.fit(data)
```

this code make a 2 array te firts arra y for trainigdata and the other is for testdat.
  
```  
    val Array(trainingData, testData) = data.randomSplit(Array(0.7, 0.3))
```
now is necesary create our random forest classifier
```
    val rf = new RandomForestClassifier()
      rf.setLabelCol("indexedLabel")
      rf.setFeaturesCol("indexedFeatures")
      rf.setNumTrees(10)
```
now we need create our label conveter this is generated by indextostring
```
    val labelConverter = new IndexToString()
      labelConverter.setInputCol("prediction")
      labelConverter.setOutputCol("predictedLabel")
      labelConverter.setLabels(labelindexed.schema("indexedLabel").metadata.getMetadata("ml_attr").getStringArray("vals"))
```
now we created a pipiline and set our parameters
```
    val pipeline = new Pipeline()
      pipeline.setStages(Array(labelIndexer, featureIndexer, rf, labelConverter))
```
now we created our model with our data training
```
    val model = pipeline.fit(trainingData)
```
now this code is for our predictions so we created our value
```
    val predictions = model.transform(testData)
```
in this part of the code we show 5 result for our prediction value
```
    predictions.select("predictedLabel", "label", "features").show(5)
```
### Result:
![image](https://user-images.githubusercontent.com/77422159/167225891-295d1c0b-b91a-4799-b973-a92e9d84f3eb.png)


for now create our multiclassclsificationevaluator and show if presente error on our result.
```
val evaluator = new MulticlassClassificationEvaluator()
evaluator.setLabelCol("indexedLabel")
evaluator.setPredictionCol("prediction")
evaluator.setMetricName("accuracy")
val accuracy = evaluator.evaluate(predictions)
println(s"Test Error = ${(1.0 - accuracy)}")
```
###result:
![image](https://user-images.githubusercontent.com/77422159/167225987-12ba5b94-b3ab-444e-82fb-5d47849dd9b5.png)

the last code show our result about how is interaction on the model create
```
val rfModel = model.stages(2).asInstanceOf[RandomForestClassificationModel]
    println(s"Learned classification forest model:\n ${rfModel.toDebugString}")
```
  
  ###result
  ![image](https://user-images.githubusercontent.com/77422159/167226002-39244bbd-63cb-485b-9889-0bf354e5bd54.png)
